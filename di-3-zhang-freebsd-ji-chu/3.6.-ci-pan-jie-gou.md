# 3.6.磁盘结构

FreeBSD 用于查找文件的最小组织单位是文件名。文件名是区分大小写的，这意味着 `readme.txt` 和 `README.TXT` 是两个不同的文件。FreeBSD 不使用文件的扩展名来判断该文件是程序、文档还是其他数据类型。

文件存储在目录中。一个目录可以没有文件，也可以包含成百上千的文件。一个目录还可以包含其他目录，从而形成一个层次化的目录结构，以组织数据。

通过给出文件或目录的名称，后跟一个正斜杠 `/`，再加上必要的其他目录名称来引用文件和目录。例如，如果目录 `foo` 中包含目录 `bar`，而 `bar` 中包含文件 `readme.txt`，该文件的完整名称或路径是 `foo/bar/readme.txt`。请注意，这与 Windows® 使用反斜杠 `\` 分隔文件和目录名称不同。FreeBSD 的路径中不使用驱动器字母或其他驱动器名称。例如，在 FreeBSD 中不会输入 `c:\foo\bar\readme.txt`。

### 3.6.1. 文件系统

目录和文件存储在文件系统中。每个文件系统在最顶层包含一个根目录，称为该文件系统的 *根目录*。该根目录可以包含其他目录。一个文件系统被指定为 *根文件系统*，即 `/`。每个其他文件系统都被 *挂载* 到根文件系统下。无论 FreeBSD 系统上有多少磁盘，每个目录都看起来是同一个磁盘的一部分。

假设有三个文件系统，分别为 `A`、`B` 和 `C`。每个文件系统都有一个根目录，其中包含两个子目录，分别为 `A1`、`A2`（同样，`B` 包含 `B1`、`B2`，`C` 包含 `C1`、`C2`）。

将 `A` 作为根文件系统。如果使用 [ls(1)](https://man.freebsd.org/cgi/man.cgi?query=ls&sektion=1&format=html) 查看该目录的内容，会显示两个子目录，`A1` 和 `A2`。目录树如下所示：

![根目录和两个子目录的目录树](https://docs.freebsd.org/images/books/handbook/basics/example-dir1.png)

一个文件系统必须挂载到另一个文件系统中的目录上。当将文件系统 `B` 挂载到目录 `A1` 时，`B` 的根目录会替代 `A1`，并且 `B` 中的目录会相应显示出来：

![根目录和两个子目录的目录树](https://docs.freebsd.org/images/books/handbook/basics/example-dir2.png)

任何在 `B1` 或 `B2` 目录中的文件都可以通过路径 `/A1/B1` 或 `/A1/B2` 访问。任何原本在 `/A1` 中的文件现在暂时不可见。如果卸载 `B`，这些文件会重新出现。

如果 `B` 挂载到 `A2`，则目录树将如下所示：

![根目录和两个子目录的目录树](https://docs.freebsd.org/images/books/handbook/basics/example-dir3.png)

相应的路径为 `/A2/B1` 和 `/A2/B2`。

文件系统可以互相叠加挂载。继续上面的例子，文件系统 `C` 可以挂载到 `B` 文件系统中的 `B1` 目录上，形成如下结构：

![复杂的目录树，根目录下有多个子目录](https://docs.freebsd.org/images/books/handbook/basics/example-dir4.png)

或者 `C` 也可以直接挂载到 `A` 文件系统下的 `A1` 目录中：

![复杂的目录树，根目录下有多个子目录](https://docs.freebsd.org/images/books/handbook/basics/example-dir5.png)

完全可以有一个大的根文件系统，而不需要创建其他文件系统。虽然这种方式有一些缺点，但也有一个优点。

多个文件系统的好处：

* 不同的文件系统可以有不同的 *挂载选项*。例如，根文件系统可以以只读方式挂载，防止用户不小心删除或编辑重要文件。将用户可写文件系统（如 `/home`）与其他文件系统分开，并以 *nosuid* 方式挂载，可以防止存储在文件系统中的可执行文件的 *suid*/*guid* 位生效，可能提高安全性。
* FreeBSD 会根据文件系统的使用情况自动优化文件布局。因此，包含许多小文件并频繁写入的文件系统会与包含较少大文件的文件系统有所不同的优化。将所有内容放在一个大文件系统中时，这种优化会失效。
* FreeBSD 的文件系统在断电时具有较强的鲁棒性。然而，在关键时刻的断电仍然可能损坏文件系统结构。通过将数据分布到多个文件系统中，系统更可能仍能启动，从而更容易从备份中恢复。

单一文件系统的好处：

* 文件系统是固定大小的。如果在安装 FreeBSD 时创建了一个特定大小的文件系统，可能会发现以后需要增大分区大小。这通常需要备份数据、重新创建文件系统并恢复数据，操作复杂。


>重要
>
> FreeBSD 提供了 [growfs(8)](https://man.freebsd.org/cgi/man.cgi?query=growfs&sektion=8&format=html) 命令，可以动态扩展文件系统的大小，从而消除这一限制。文件系统只能扩展到所在分区中的空闲空间。如果分区后面有空闲空间，则可以使用 [gpart(8)](https://man.freebsd.org/cgi/man.cgi?query=gpart&sektion=8&format=html) 扩展分区。如果该分区是虚拟磁盘上的最后一个分区，并且磁盘已扩展，则可以扩展该分区。 
