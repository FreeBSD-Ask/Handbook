# 2.3.安装前的准备工作

在确定设备符合安装 FreeBSD 的最低硬件要求后，就可下载安装文件并准备安装介质。

|  | 如果您想在已安装其他操作系统的系统上使用 FreeBSD，请考虑使用虚拟机。 |
| -- | ---------------------------------------------------------------------- |

在继续安装之前，请通过验证此清单中的项目来检查设备是否准备就绪：

1. **备份重要数据**

在安装其他操作系统之前，请先备份所有重要数据。不要将备份存储在将要安装的设备上。应将数据保存到可移动磁盘，如 USB 驱动器、网络上的其他设备及在线备份服务。在开始安装之前测试备份，以确保其中包含所有所需文件。一旦安装程序格式化系统磁盘后，存储在该磁盘上的所有数据将丢失。

2. **决定把 FreeBSD 安装到哪**

如果只安装 FreeBSD 这一个操作系统，则可以跳过此步骤。但是，如果 FreeBSD 将与其他操作系统共享磁盘，请决定将哪个磁盘或分区给 FreeBSD。

在 i386 和 amd64 架构中，磁盘可以使用两种分区方案之一分成多个分区。 传统的主引导记录（Master Boot Record，MBR）包含一个最多可定义四个主分区的分区表。由于历史原因，FreeBSD 将这些主分区称为切片（slices）。其中一个主分区可以转换为包含多个逻辑分区的扩展分区。GUID 分区表（GPT）是一种更新且更简单的磁盘分区方法。常见的 GPT 实现允许每个磁盘最多有 128 个分区，消除了逻辑分区的需要。

FreeBSD 引导加载程序需要主分区或任一 GPT 分区。如果所有主分区或 GPT 分区均在使用中，则必须释放一个分区以供 FreeBSD 使用。要创建分区而不删除现有数据，可使用分区调整工具缩小现有分区并使用释放的空间以创建新分区。

修改系统现有磁盘分区的替代方法是使用虚拟化技术，这可使多个操作系统同时运行，而无需更改分区。

在列出的免费和商业分区调整工具中，GParted Live 是一个包含 GParted 分区编辑器的免费 Live CD。

|  | 使用正确的磁盘缩小工具可以安全地为创建新分区创建空间。由于存在选择错误分区的可能性，请始终备份任何重要数据并在修改磁盘分区之前验证备份的完整性。 |
| -- | -------------------------------------------------------------------------------------------------------------------------------------------------- |

包含不同操作系统的磁盘分区，使得在一台计算机上安装多个操作系统成为可能。

3. **收集网络信息**

一些 FreeBSD 安装方法需要网络连接才能下载安装文件。在任何安装后，安装程序将提供设置设备网卡的选项。

如果网络中有 DHCP 服务器，则可以使用它来提供自动网络配置。如果没有 DHCP，则必须从本地网络管理员或互联网服务提供商获取系统的以下网络信息：

必需网络信息

1. IP 地址
2. 子网掩码
3. 默认网关的 IP 地址
4. 网络的域名
5. 网络 DNS 服务器的 IP 地址
6. **检查 FreeBSD 勘误**

尽管 FreeBSD 项目努力确保每个版本的 FreeBSD 尽可能稳定，但偶尔会出现错误。在极少数情况下，这些错误会影响安装过程。当这些问题被发现并解决时，它们会被记录在每个版本的 FreeBSD 勘误页中。在安装前检查勘误，确保没有可能影响安装的问题。

在 FreeBSD 发布信息页面上可以找到所有版本的信息和勘误。

### 2.3.1. 准备安装介质

FreeBSD 安装程序无法在其他系统上运行。应该下载 FreeBSD 安装文件，将其刻录到与其文件类型和大小相关联的介质（CD，DVD 或 USB），然后引导系统以从插入的介质安装。

可在 FreeBSD 下载页面上找到 FreeBSD 安装文件。每个安装文件的名称包括 FreeBSD 的发行版本、体系结构和文件类型。

安装文件以多种格式提供，使用 xz(1) 压缩或未经压缩。这些格式根据计算机架构和媒体类型而变化。

安装文件类型：

*  **-bootonly.iso** ：这是最精简的安装文件，因为它只包含安装程序。在安装过程中需要正常的互联网连接，因为安装程序将下载完成 FreeBSD 安装所需的文件。这个文件应该被刻录到光盘。
*  **-disc1.iso** ：此文件包含安装 FreeBSD、其源代码和Ports集合所需的所有文件。应将此文件刻录到光学介质中。
*  **-dvd1.iso** ：此文件包含安装 FreeBSD、其源代码和 Ports 所需的所有文件。还包括一组流行的二进制软件包，用于安装窗口管理器和一些应用程序，从而可以从介质上安装完整系统，而无需连接到互联网。应将此文件刻录到光学介质中。
*  **-memstick.img** ：此文件包含安装 FreeBSD、其源代码和Ports集合所需的所有文件。按照《将镜像文件写入 USB》中所示，将此文件写入 USB 闪存驱动器。
*  **-mini-memstick.img** ：与  **-bootonly.iso** 一样，不包括安装文件，但会在需要时下载。安装过程中需要一个正常的互联网连接。应该按照《将镜像文件写入 USB》中所示的方法写入 USB 闪存驱动器。

下载完镜像文件后，请再从相同目录中下载至少一个校验文件。有两个校验文件可用，分别以发布编号和架构名称命名。例如： CHECKSUM.SHA256-FreeBSD-13.1-RELEASE-amd64 和 CHECKSUM.SHA512-FreeBSD-13.1-RELEASE-amd64 。

下载完其中一个文件（或两个文件）后，请计算镜像文件的校验和，并将其与校验文件中显示的校验和进行比较。请注意，您需要将计算出的校验和与正确的文件进行对比，因为它们对应于两种不同的算法：SHA256 和 SHA512。FreeBSD 提供了可用于计算校验和的 sha256(1)和 sha512(1)。其他操作系统也有类似的程序。

FreeBSD 中使用 sha256sum(1)（和 sha512sum(1)）可以自动验证校验和，方法如下：

```
% sha256sum -c CHECKSUM.SHA256-FreeBSD-13.1-RELEASE-amd64 FreeBSD-13.1-RELEASE-amd64-dvd1.iso
FreeBSD-13.1-RELEASE-amd64-dvd1.iso: OK
```

校验和必须完全一致。如果校验和不匹配，则镜像文件已损坏，必须重新下载。

#### 2.3.1.1. 将镜像文件写入 USB

*memstick.img 文件是内存卡完整内容的镜像。它不能作为文件复制到目标设备。有几个应用程序可用于将 *.img 写入 USB 存储设备。本节描述其中两种实用程序。

|  | 在继续之前，请备份 USB 存储设备上的任何重要数据。此过程将擦除存储设备上的现有数据。 |
| -- | ------------------------------------------------------------------------------------- |

**步骤。使用 dd 写入镜像**

|  | 此示例将 /dev/da0 用作将镜像写入的目标设备。一定要非常小心，使用正确的设备，因为此命令将破坏指定目标设备上的现有数据。 |
| -- | ------------------------------------------------------------------------------------------------------------------------ |

1. 该命令行工具适用于 BSD、Linux® 和 Mac OS® 系统。要使用 dd 刻录镜像，插入 USB 闪存驱动器并确定其设备名称。然后，指定已下载安装文件的名称和 USB 闪存驱动器的设备名称。此示例将 amd64 安装镜像刻录到现有 FreeBSD 系统上的第一个 USB 设备。

```
# dd if=FreeBSD-13.1-RELEASE-amd64-memstick.img of=/dev/da0 bs=1M conv=sync
```

如果此命令失败，请验证 USB 闪存驱动器未挂载，并且设备名称是磁盘而不是分区。

一些操作系统可能需要使用 sudo(8) 命令来运行。不同平台下 dd(1)的语法略有不同；例如，Mac OS®需要小写的 bs=1m 。像 Linux®这样的系统可能会对写入进行缓冲。要强制所有写入完成，使用 sync(8)。

**步骤。使用 Windows®写入镜像**

|  | 请确保输入正确的驱动器号，因为指定驱动器上的现有数据将被覆盖和销毁。 |
| -- | ---------------------------------------------------------------------- |

1. **获取 Windows® 的镜像制作器**

Windows® 的镜像制作器是一个免费应用程序，可以正确地将镜像文件写入存储卡。从 win32diskimager 主页下载它并将其解压缩到一个文件夹中。

2. **使用镜像编写器制作镜像**

双击 Win32DiskImager 图标启动程序。验证在 Device 下显示的驱动器字母是否为带有存储设备的驱动器。单击文件夹图标，选择要写入存储设备的镜像。单击保存以接受镜像文件名。验证一切是否正确，并且存储设备上没有文件夹在其他窗口中打开。当一切准备就绪时，单击“写入”以将镜像文件写入存储设备。
