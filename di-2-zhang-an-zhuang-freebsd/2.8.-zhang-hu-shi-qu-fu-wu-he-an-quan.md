# 2.8.网络、账户、时区、服务和安全

### 2.8.1. 设置 root 密码

首先，必须设置 root 密码。在输入密码时，所输入的字符不会显示在屏幕上。密码必须输入两次，以防止输入错误。

![Menu showing requesting the password for the root user](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-post-root-passwd.png)

图 34. 设置 root 密码

### 2.8.2. 配置网络接口

然后，将显示在计算机上找到的网络接口列表。选择要配置的接口。

![Menu showing the different network interfaces to configure](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-interface.png)

图 35. 选择网络接口

如果选择了以太网接口，安装程序将直接跳转到“选择 IPv4 网络”菜单。如果选择了无线网络接口，则系统将扫描无线访问点。

![Menu showing wireless network scanning](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-wireless-scan.png)

导致 36. 扫描无线访问点

无线网络由服务集标识符 (SSID) 标识; 为每个网络指定的简短、独特名称。将列出扫描期间找到的 SSID，及该网络可用的加密类型的说明。如果所需的 SSID 未在列表中出现，请选择重新扫描以再次扫描。如果所需网络仍未显示，请检查天线连接是否存在问题，或尝试将计算机移动到靠近访问点的位置。在每次进行更改后都重新扫描。

![Menu showing the different wireless networks to connect to](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-wireless-accesspoints.png)

导致 37. 选择无线网络

接下来，输入连接到所选无线网络的加密信息。强烈建议使用 WPA2 加密，而非较老的加密类型，如 WEP，后者提供的安全性较弱。如果网络使用 WPA2，请输入密码，也称为预共享密钥（PSK）。出于安全原因，输入框中输入的字符显示为星号。

![Menu requesting the wireless network password](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-wireless-wpa2setup.png)

图 38。WPA2 设置

接下来，选择是否在以太网或无线接口上配置 IPv4 地址：

![Menu indicating if IPv4 wants to be configured for the selected interface](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-interface-ipv4.png)

选择 IPv4 网络

有两种方法配置 IPv4：如果网络提供了 DHCP 服务器，则 DHCP 将自动正确配置网络接口并使用。如果没有 DHCP，则需要手动输入地址信息来静态配置。

|  | 请勿乱输网络信息，这不起作用。如果没有 DHCP 服务器，请向网络管理员或互联网服务提供商获取“所需网络信息”中列出的信息。 |
| -- | ------------------------------------------------------------------------------------------------------------------------------------ |

如果存在 DHCP 服务器，请在下个菜单中选择是，以自动配置网络接口。安装程序将暂停约一分钟，期间它将找到 DHCP 服务器并获取系统的寻址信息。

![Menu indicating if DHCP wants to be configured for the selected interface](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-interface-ipv4-dhcp.png)

图 40. 选择 IPv4 DHCP 配置

如果没有 DHCP 服务器，请选择否，并在该菜单中输入以下寻址信息：

![Menu requesting data to configure IPv4 network](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-interface-ipv4-static.png)

静态 IPv4 配置图

* IP Address - 分配给此计算机的 IPv4 地址。地址必须是唯一的，并且未被本地网络上的其他设备使用。
* Subnet Mask - 网络的子网掩码。
* Default Router - 网络默认网关的 IP 地址。

接下来的菜单将询问接口是否应配置为 IPv6。如果 IPv6 可用并且需要，选择“是”以选择它。

![Menu indicating if IPv6 wants to be configured for the selected interface](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-interface-ipv6.png)

图 42。选择 IPv6 网络

IPv6 也有两种配置方法。StateLess Address AutoConfiguration（SLAAC）将自动从本地路由器请求正确的配置信息。有关更多信息，请参阅 rfc4862。静态配置需要手动输入网络信息。

如果 IPv6 路由器可用，请在下个菜单中选择“是”，以自动配置网络接口。安装程序将在找到路由器并获取系统的寻址信息时停顿约一分钟左右。

![Menu indicating if SLAAC wants to be configured for the selected interface](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-interface-slaac.png)

图 43。选择 IPv6 SLAAC 配置

如果 IPv6 路由器不可用，请选择“否”并在此菜单中输入以下寻址信息：

![Menu requesting data to configure IPv6 network](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-interface-ipv6-static.png)

图 44. IPv6 静态配置

* IPv6 Address - 分配给此计算机的 IPv6 地址。该地址必须是唯一的，未被本地网络上的其他设备使用。
* Default Router - 网络默认网关的 IPv6 地址。

最后一个网络配置菜单用于配置域名系统（DNS）解析器，该解析器将主机名转换为网络地址，并从网络地址转换回主机名。如果使用 DHCP 或 SLAAC 自动配置网络接口，则 Resolver Configuration 值可能已经填写。否则，在 Search 字段中输入本地网络的域名。 DNS #1 和 DNS #2 是 DNS 服务器的 IPv4 和/或 IPv6 地址。至少需要填写一个 DNS 服务器。

![Menu requesting data to configure DNS for the network](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-configure-network-ipv4-dns.png)

图 45. DNS 配置

界面配置完成后，请选择一个位于与安装 FreeBSD 的计算机相同地区的镜像站点。当镜像站点靠近目标计算机时，可以更快地检索文件，从而减少安装时间。

|  | 选择 [ftp://download.freebsd.org](ftp://download.freebsd.org/) (Main Site) 将自动路由到最近的镜像站点。 |
| -- | ------------------------------------------------ |

![Menu requesting a network mirror](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-netinstall-mirrorselect.png)

图 46. 选择镜像

### 设置时区

下一系列菜单用于通过选择地理区域、国家和时区来确定正确的当地时间。设置时区允许系统自动纠正区域时间变化，如夏令时，并正确执行其他与时区相关的功能。

此处显示的示例是位于欧洲西班牙大陆时区的机器。根据地理位置不同，选择项会有所变化。

![Menu requesting the timezone region](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-timezone-region.png)

选择一个地区

使用箭头键选择适当的地区，然后按回车键。

![Menu requesting the timezone country](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-timezone-country.png)

选择一个国家

使用箭头键选择适当的国家，然后按回车键。

![Menu requesting the timezone zone](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-timezone-zone.png)

图 49. 选择时区

使用箭头键选择适当的时区，然后按回车键。

![Menu requesting confirmation of the selected timezone](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-timezone-confirm.png)

\u786e\u8ba4\u65f6\u95f4\u533a

\u786e\u8ba4\u65f6\u533a\u7684\u7f29\u5199\u6cd5\u6b63\u786e\u3002

![Menu requesting the system date](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-timezone-date.png)

\u56fe\u7247 51\u3002\u9009\u62e9\u65e5\u671f

使用箭头键选择适当的日期，然后按“设置日期”来选择日期。否则，可以通过按“跳过”来跳过日期选择。

![Menu requesting the system time](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-timezone-time.png)

图 52. 选择时间

使用箭头键选择适当的时间，然后按“设置时间”来选择时间。否则，可以通过按“跳过”来跳过时间选择。

### 2.8.4. 启用服务

下一个菜单用于配置系统启动时将启动哪些系统服务。所有这些服务都是可选的。应只启动系统运行所需的服务。

![Menu showing the different services available](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-config-services.png)

图 53. 选择要启用的附加服务

这里是可以在此菜单中启用的服务摘要：

* local_unbound - 启用 DNS 本地 unbound。请记住，这仅适用于作为本地缓存转发解析器的配置。如果目标是为整个网络设置解析器，请安装 dns/unbound。
* sshd - 安全外壳（SSH）守护程序用于通过加密连接远程访问系统。只有在系统应该提供远程登录时才启用此服务。
* moused - 如果从命令行系统控制台使用鼠标，则启用此服务。
* ntpdate - 在启动时启用自动时钟同步。请注意，此程序的功能现在已经包含在 ntpd(8) 守护程序中，工具 ntpdate(8) 将很快被弃用。
* ntpd - 用于自动时钟同步的网络时间协议（NTP）守护程序。如果您希望将系统时钟与远程时间服务器或时间池同步，请启用此服务。
* powerd - 用于电源控制和节能的系统电源控制实用程序。
* dumpdev - 在调试系统问题时，崩溃转储非常有用，因此建议用户启用它。

### 2.8.5. 启用加固安全选项

下一个菜单用于配置启用哪些安全选项。所有这些选项都是可选的。但鼓励使用它们。

![Menu shoring the different hardening security options](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-hardening.png)

图 54。选择加固安全选项

这里是可以在此菜单中启用的选项摘要。

* hide_uids - 隐藏以其他用户（UID）身份运行的进程。这可以防止非特权用户查看其他用户正在运行的进程。
* hide_gids - 隐藏以其他组（GID）身份运行的进程。这可以防止非特权用户查看其他组正在运行的进程。
* hide_jail - 隐藏在监狱中运行的进程。这可以防止非特权用户看到在 jail 中运行的进程。
* read_msgbuf - 禁用未授权用户读取内核消息缓冲区。防止未授权用户使用 dmesg(8)查看内核日志缓冲区中的消息。
* proc_debug - 禁用未授权用户的进程调试功能。禁用各种未授权用户间的进程调试服务，包括一些 procfs 功能， ptrace() 以及 ktrace() 。请注意，这也将阻止诸如 lldb(1), truss(1)和 procstat(1)等调试工具，以及某些脚本语言中的一些内置调试功能，如 PHP。
* random_pid - 随机化进程的 PID。
* clear_tmp - 系统启动时清理 /tmp 。
* disable_syslogd - 禁用打开 syslogd 网络套接字。默认情况下，FreeBSD 以 -s 方式安全运行 syslogd。这会阻止守护程序在port 514 上监听传入的 UDP 请求。启用此选项后，syslogd 将以 -ss 运行，从而防止 syslogd 打开任何port。有关更多信息，请参阅 syslogd(8)。
* disable_sendmail - 禁用 sendmail 邮件传输代理。
* secure_console - 使命令提示符在进入单用户模式时请求 root 密码。
* disable_ddtrace - DTrace 可以运行在影响运行中内核的模式。除非明确启用，否则不得使用破坏性操作。在使用 DTrace 时，请使用 -w 来启用此选项。有关更多信息，请参阅 dtrace(1)。
* enable_aslr - 启用地址布局随机化。有关地址布局随机化的更多信息，可以查阅维基百科有关文章。

### 2.8.6. 添加用户

下一个菜单提示至少创建一个用户账户。建议使用用户账户登录系统，而不是 root 。以 root 登录时，实际上可以做任何事情，没有任何限制和保护。以普通用户身份登录更安全更可靠。

选择是以添加新用户。

![Menu requesting if a user want to be added to the system](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-adduser1.png)

添加用户账户

按照提示输入用户账户所需的信息。在“输入用户信息”中显示的示例创建 asample 用户账户。

![Menu requesting different information for the new user](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-adduser2.png)

输入用户信息

这是输入信息摘要：

* Username - 用户将输入的名称。通常的约定是使用名字的第一个字母与姓氏结合在一起作为登录名，只要系统中每个用户名是唯一的。用户名区分大小写，不能有任何空格。
* Full name - 用户的全名。这可以包含空格，并被用作用户帐户的简介。
* Uid - 用户 ID。通常留空，系统会自动分配一个值。
* Login group - 用户组。通常留空以接受默认值。
* Invite *user* into other groups? - 用户将被添加为成员的其他组。如果用户需要管理访问权限，请在此处输入 wheel 。
* Login class - 通常保持默认值为空。
* Shell - 输入列表中的一个值以为用户设置交互式 shell。有关 shell 的更多信息，请参阅 Shell。
* Home directory - 用户的主目录。通常默认值是正确的。
* Home directory permissions - 用户的主目录上的权限。通常情况下默认设置是正确的。
* Use password-based authentication? - 通常 yes 以便用户在登录时输入密码。
* Use an empty password? - 通常 no ，因为空密码是不安全的。
* Use a random password? - 通常为 no ，以便用户在下一个提示中设置自己的密码。
* Enter password - 该用户的密码。键入的字符将不会显示在屏幕上。
* Enter password again - 必须再次键入密码以进行验证。
* Lock out the account after creation? - 通常是 no 以便用户可以登录。

输入所有细节后，会显示一个摘要供查看。如果有错误，请输入 no 进行更正。一切都正确无误后，请输入 yes 创建新用户。

![Menu showing the information of the new user and requesting if everything is correct](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-adduser3.png)

图 57. 退出用户和组管理

如果有更多用户要添加，请用 Add another user? 回复问题 yes 。输入 no 完成添加用户并继续安装。

有关添加用户和用户管理的更多信息，请参阅用户和基本账户管理。

### 2.8.7. 最终配置

安装和配置完成后，提供了最后修改设置的机会。

![Menu showing different options to perform before finishing the installation Ex Add user](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-finalconfiguration.png)

图 58。最终配置

在完成安装之前，使用此菜单进行任何更改或进行任何其他配置。

* Add User - 在添加用户中说明。
* Root Password - 在设置 root 密码中说明。
* Hostname - 在设置主机名中说明。
* Network - 在配置网络接口中说明。
* Services - 在启用服务中说明。
* System Hardening - 在启用加固安全选项中说明。
* Time Zone - 设置时区。
* Handbook - 下载并安装 FreeBSD 手册。

配置完成后，选择退出。

![Menu showing that the installation has finished And asking if you want to open a shell to make manual changes](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-final-modification-shell.png)

手动配置图 59。

bsdinstall 将提示是否需要在重启进入新系统之前进行任何其他配置。选择“是”退出到新系统中的 shell，选择“否”继续安装的最后一步。

![Menu showing that the installation has finished and asking whether to reboot the system or access the Live CD](https://docs.freebsd.org/images/books/handbook/bsdinstall/bsdinstall-mainexit.png)

完成安装图 60。

如果需要进一步配置或特殊设置，请选择 Live CD 以将安装介质引导到 Live CD 模式。

如果安装完成，请选择重新启动以重新启动计算机并启动新的 FreeBSD 系统。不要忘记移除 FreeBSD 安装介质，否则计算机可能会再次从中引导。

当 FreeBSD 启动时，会显示信息提示。系统启动完成后，会显示登录提示符。在 login: 提示符下，输入安装过程中添加的用户名。避免以 root 登录。请参阅超级用户账户，了解在需要管理访问权限时如何成为超级用户的说明。

启动过程中出现的消息可以通过按下滚动锁定键来查看滚动缓冲区。可以使用 PgUp、PgDn 和箭头键来回滚这些消息。完成后，再次按下滚动锁定键以解锁显示并返回控制台。要在系统运行一段时间后查看这些消息，请在命令提示符中键入 less /var/run/dmesg.boot 。查看后按 q 返回命令行。

如果在选择要启用的其他服务时启用了 sshd，则第一次启动可能会慢一点，因为系统正在生成 SSH 主机密钥。后续的启动速度将会更快。然后会显示密钥的指纹，如下例所示：

```
Generating public/private rsa1 key pair.
Your identification has been saved in /etc/ssh/ssh_host_key.
Your public key has been saved in /etc/ssh/ssh_host_key.pub.
The key fingerprint is:
10:a0:f5:af:93:ae:a3:1a:b2:bb:3c:35:d9:5a:b3:f3 root@machine3.example.com
The key's randomart image is:+--[RSA1 1024]----+|    o..          ||   o . .         ||  .   o          ||       o         ||    o   S        ||   + + o         ||o . + *          ||o+ ..+ .         ||==o..o+E         |+-----------------+Generating public/private dsa key pair.Your identification has been saved in /etc/ssh/ssh_host_dsa_key.Your public key has been saved in /etc/ssh/ssh_host_dsa_key.pub.The key fingerprint is:7e:1c:ce:dc:8a:3a:18:13:5b:34:b5:cf:d9:d1:47:b2 root@machine3.example.comThe key's randomart image is:
+--[ DSA 1024]----+
|       ..     . .|
|      o  .   . + |
|     . ..   . E .|
|    . .  o o . . |
|     +  S = .    |
|    +  . = o     |
|     +  . * .    |
|    . .  o .     |
|      .o. .      |
+-----------------+
Starting sshd.
```

有关指纹和 SSH 的更多信息，请参考 OpenSSH。

FreeBSD 默认情况下不会安装图形界面。有关安装和配置图形窗口管理器的更多信息，请参阅 X Window 系统。

正确对 FreeBSD 计算机进行关机操作有助于保护数据和硬件免受损坏。在系统正确关机之前，请勿关闭电源！如果用户是 wheel 组的成员，请在命令行上输入 su 以成为超级用户，并输入 root 密码。然后，键入 shutdown -p now ，系统将彻底关闭，如果硬件支持，会自动断电。
